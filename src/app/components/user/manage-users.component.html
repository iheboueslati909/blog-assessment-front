<div class="bg-gray-800 p-4 rounded">
  <h2 class="text-xl font-semibold mb-4">Manage Users</h2>

  <div *ngIf="loading" class="text-gray-500">Loading...</div>
  <div *ngIf="error" class="text-red-500">{{ error }}</div>

  <ng-container *ngIf="!loading && !error">
    <table *ngIf="users.length > 0; else noUsers" class="w-full table-auto">
      <thead>
        <tr class="text-left text-sm text-gray-300">
          <th class="p-2">Name</th>
          <th class="p-2">Email</th>
          <th class="p-2">Role</th>
          <th class="p-2 text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of users" class="border-t border-gray-700">
          <td class="p-2">{{ u.name }}</td>
          <td class="p-2">{{ u.email }}</td>
          <td class="p-2">
            <select
              class="bg-gray-700 text-gray-200 rounded px-2 py-1 text-sm"
              [ngModel]="u.pendingRole"
              (ngModelChange)="setPendingRole(u, $event)"
              [disabled]="isSelf(u) && u.roles?.[0] === 'Admin'"
            >
              <option *ngFor="let r of rolesOptions" [value]="r">{{ r }}</option>
            </select>
          </td>
          <td class="p-2 text-right">
            <button
              (click)="commitRole(u)"
              class="px-3 py-1 bg-green-600 hover:bg-green-500 rounded text-sm text-white"
              [disabled]="u.pendingRole === u.roles?.[0]"
            >
              ✅ Save
            </button>
          </td>
        </tr>
      </tbody>
    </table>
 
    <ng-template #noUsers>
      <p class="text-gray-400">No users found.</p> 
    </ng-template>

    <div class="mt-4 flex items-center justify-between">
      <div class="text-sm text-gray-400"> 
        Page {{ page }} / {{ totalPages }} — {{ total }} users
      </div>
      <div class="space-x-2">
        <button (click)="prev()" class="px-3 py-1 bg-gray-700 rounded" [disabled]="page<=1">Prev</button>
        <button (click)="next()" class="px-3 py-1 bg-gray-700 rounded" [disabled]="page>=totalPages">Next</button>
      </div>
    </div>
  </ng-container>
</div>
